<!DOCTYPE html>
<html lang="en" data-theme="sakura">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLAY ZONE STORE | Premium Gaming Store</title>
    
    <!-- PERFORMANCE -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://firebasestorage.googleapis.com">
    <link rel="preconnect" href="https://upload.wikimedia.org">
    <link rel="preconnect" href="https://i.ibb.co">

    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --font-main: 'Inter', sans-serif;
            --radius-md: 12px; --radius-lg: 16px;
            --bg-body: #fff0f5; --bg-card: #ffffff; --bg-input: #ffeef2;
            --text-main: #5c3a45; --text-muted: #9c6b7a;
            --accent: #ff69b4; --accent-text: #fff; --border: #ffccd5;
            --nav-bg: rgba(255, 240, 245, 0.98); --shadow: 0 4px 12px rgba(255, 105, 180, 0.15);
            --success: #25D366; --error: #ff3b30;
        }

        [data-theme="dark"] { --bg-body: #0f0f12; --bg-card: #1a1a20; --bg-input: #2a2a32; --text-main: #ffffff; --text-muted: #a0a0a0; --accent: #f5c518; --accent-text: #000; --border: #333; --nav-bg: #0f0f12; }
        [data-theme="light"] { --bg-body: #f4f5f7; --bg-card: #ffffff; --bg-input: #e9ecef; --text-main: #111; --text-muted: #666; --accent: #000; --accent-text: #fff; --border: #ddd; --nav-bg: #f4f5f7; }
        [data-theme="blue"] { --bg-body: #0a1929; --bg-card: #132f4c; --bg-input: #173a5e; --text-main: #e3f2fd; --text-muted: #90caf9; --accent: #2196f3; --accent-text: #fff; --border: #1e4976; --nav-bg: #0a1929; }

        /* Base Reset */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        html, body { font-family: var(--font-main); background: var(--bg-body); color: var(--text-main); padding-bottom: 100px; touch-action: pan-x pan-y; overflow-x: hidden; }
        a { text-decoration: none; color: inherit; }
        button { border: none; background: none; cursor: pointer; font-family: inherit; }
        img { display: block; width: 100%; height: 100%; object-fit: cover; }
        .flex { display: flex; align-items: center; }
        .hidden { display: none !important; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 16px; }

        /* Header */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 60px; background: var(--nav-bg); backdrop-filter: blur(12px); z-index: 100; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 16px; }
        .logo { font-weight: 800; font-size: 1.25rem; letter-spacing: 0.5px; color: var(--accent); }
        .header-icons { display: flex; gap: 12px; align-items: center; }
        .coin-pill { background: var(--bg-card); border: 1px solid var(--border); padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; display: flex; align-items: center; gap: 6px; color: var(--text-main); box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; }
        .coin-icon-svg { width: 18px; height: 18px; }
        .badge { position: absolute; top: 2px; right: 2px; width: 8px; height: 8px; background: #ff0055; border-radius: 50%; transform: scale(0); transition: 0.2s; }
        .badge.active { transform: scale(1); }

        /* Drawer */
        .drawer { position: fixed; top: 0; left: -100%; width: 280px; height: 100%; background: var(--bg-body); z-index: 200; border-right: 1px solid var(--border); transition: 0.3s; padding: 24px; display: flex; flex-direction: column; box-shadow: 10px 0 30px rgba(0,0,0,0.1); }
        .drawer.open { left: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 199; display: none; backdrop-filter: blur(2px); }
        .overlay.open { display: block; }
        .drawer-link { padding: 14px 0; border-bottom: 1px solid var(--border); font-weight: 500; cursor: pointer; }

        /* Hero */
        .hero-banner { margin-top: 60px; width: 100%; height: 200px; position: relative; overflow: hidden; background: var(--bg-input); }
        .hero-img { width: 100%; height: 100%; object-fit: cover; filter: none !important; opacity: 1 !important; }

        /* Quick Actions */
        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
        .action-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 16px 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; transition: var(--transition); box-shadow: var(--shadow); cursor: pointer; }
        .action-icon-box { width: 32px; height: 32px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; }
        .action-icon { width: 100%; height: 100%; fill: var(--accent); }
        .action-text { font-size: 0.8rem; font-weight: 600; color: var(--text-main); }

        /* Search */
        .search-wrap { margin: 24px 0; position: relative; width: 100%; display: flex; align-items: center; }
        .search-input { width: 100%; background: var(--bg-card); border: 1px solid var(--border); padding: 14px 16px 14px 48px; border-radius: var(--radius-lg); color: var(--text-main); font-weight: 500; font-size: 0.95rem; box-shadow: var(--shadow); transition: var(--transition); }
        .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 20px; fill: var(--text-muted); pointer-events: none; }

        /* Games Grid */
        .games-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .game-card { cursor: pointer; background: var(--bg-card); border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border); transition: transform 0.2s; display: flex; flex-direction: column; }
        .game-img-wrap { width: 100%; aspect-ratio: 1/1; background: var(--bg-input); position: relative; }
        .game-title { font-size: 0.75rem; text-align: center; font-weight: 600; padding: 8px 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 44px; line-height: 1.2; display: flex; align-items: center; justify-content: center; }

        /* Product */
        .product-header { position: relative; height: 180px; border-radius: 0 0 var(--radius-lg) var(--radius-lg); overflow: hidden; margin-bottom: 20px; background: var(--bg-input); }
        .back-btn { position: absolute; top: 20px; left: 16px; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 50%; color: #fff; z-index: 10; cursor: pointer; }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
        .form-label { font-size: 0.8rem; font-weight: 700; margin-bottom: 6px; display: block; }
        .form-input { width: 100%; background: var(--bg-card); border: 1px solid var(--border); padding: 12px; border-radius: var(--radius-md); color: var(--text-main); font-size: 0.95rem; transition: 0.2s; }
        .form-input:focus { border-color: var(--accent); }

        .packs-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .pack-card { background: var(--bg-card); padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--border); text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 110px; transition: 0.2s; }
        .pack-card.selected { border: 2px solid var(--accent); background: rgba(255, 105, 180, 0.05); }
        .pack-img { width: 40px; height: 40px; object-fit: contain; margin-bottom: 8px; display: block; }
        .pack-name { font-size: 0.85rem; margin-bottom: 4px; line-height: 1.2; font-weight: 600; }
        .pack-price { font-weight: 800; color: var(--accent); font-size: 1rem; }

        .payment-methods { margin-top: 24px; }
        .upi-container { background: #fff; border: 1px solid #e0e0e0; border-radius: var(--radius-md); padding: 14px 16px; display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; transition: 0.2s; height: 60px; }
        .upi-container.selected { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); background: #fffcfd; }
        .upi-logo-img { height: 100%; max-height: 32px; width: auto; display: block; object-fit: contain; }
        .pay-btn { width: 100%; background: var(--accent); color: var(--accent-text); padding: 16px; border-radius: var(--radius-lg); font-weight: 700; font-size: 1rem; margin-top: 24px; box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4); transition: 0.2s; }
        .pay-btn:active { transform: scale(0.98); }

        /* Auth */
        .auth-box { max-width: 400px; margin: 60px auto; text-align: center; padding: 20px; }
        .auth-btn { width: 100%; background: var(--accent); color: var(--accent-text); padding: 14px; border-radius: var(--radius-md); font-weight: 700; margin-top: 10px; }
        .toggle-auth { color: var(--accent); cursor: pointer; font-weight: 600; margin-top: 20px; display: inline-block; }

        /* Profile */
        .profile-card { background: var(--bg-card); padding: 24px; border-radius: var(--radius-lg); border: 1px solid var(--border); text-align: center; margin-top: 20px; }
        .profile-avatar { width: 80px; height: 80px; background: var(--bg-input); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 800; color: var(--accent); }
        .profile-name { font-size: 1.2rem; font-weight: 700; margin-bottom: 4px; }
        .profile-email { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 24px; }
        .profile-stat { background: var(--bg-input); padding: 12px; border-radius: var(--radius-md); display: inline-block; width: 100%; margin-bottom: 12px; }

        /* History */
        .list-item { background: var(--bg-card); padding: 16px; border-radius: var(--radius-md); border: 1px solid var(--border); margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .status-failed { background: #ffe2e2; color: #991b1b; }
        .rank-num { font-weight: 900; color: var(--accent); font-size: 1.2rem; width: 30px; }

        /* Notifications */
        .notif-list { max-height: 300px; overflow-y: auto; text-align: left; }
        .notif-item { padding: 12px 0; border-bottom: 1px solid var(--border); }
        .notif-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 4px; }
        .notif-body { font-size: 0.85rem; color: var(--text-muted); }

        /* Footer (Fixed Alignment) */
        .footer { text-align: center; padding: 40px 20px; border-top: 1px solid var(--border); margin-top: 40px; background: var(--bg-card); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .footer-socials { display: flex; justify-content: center; gap: 24px; margin-bottom: 16px; }
        .footer-social-icon { width: 28px; height: 28px; fill: var(--text-main); transition: 0.2s; }
        .dev-contact { color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; display: block; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; }

        /* Modals */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:300; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:0.3s; backdrop-filter: blur(4px); }
        .modal.active { opacity:1; pointer-events:auto; }
        .modal-box { background: var(--bg-card); width: 85%; max-width: 360px; padding: 24px; border-radius: var(--radius-lg); text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-height: 80vh; overflow-y: auto; }
        .skeleton { background: linear-gradient(90deg, var(--bg-input) 25%, var(--bg-card) 50%, var(--bg-input) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: var(--radius-md); }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    </style>
</head>
<body>

    <div id="app">
        <!-- HEADER -->
        <header>
            <div class="flex">
                <button onclick="window.toggleDrawer()" style="margin-right: 16px;">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
                </button>
                <div class="logo">PLAY ZONE STORE</div>
            </div>
            <div class="header-icons">
                <div class="coin-pill" onclick="window.openAddCoins()">
                    <svg class="coin-icon-svg" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#FBBF24"/><circle cx="12" cy="12" r="7" stroke="#B45309" stroke-width="2" stroke-opacity="0.5"/><path d="M10.5 8h3l-1.5 8h-1.5z" fill="#B45309"/></svg>
                    <span id="user-coins">0</span>
                </div>
                <button class="icon-btn" onclick="window.openNotifications()">
                    <svg width="26" height="26" fill="currentColor" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                    <div id="notif-badge" class="badge"></div>
                </button>
                <button class="icon-btn" onclick="window.handleProfileClick()">
                    <svg width="26" height="26" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                </button>
            </div>
        </header>

        <!-- DRAWER -->
        <div class="overlay" id="overlay" onclick="window.toggleDrawer()"></div>
        <div class="drawer" id="drawer">
            <h2 style="margin-bottom: 30px; color: var(--accent);">MENU</h2>
            <div class="drawer-link" onclick="window.setView('home')">Home</div>
            <div class="drawer-link" onclick="window.loadHistory()">Order History</div>
            <div class="drawer-link" onclick="window.openPolicy('termsAndConditions', 'Terms & Conditions')">Terms & Conditions</div>
            <div class="drawer-link" onclick="window.openPolicy('refundPolicy', 'Refund Policy')">Refund Policy</div>
            <div class="drawer-link" onclick="window.location.href='https://wa.me/916000859515'">Contact Support</div>
            <div class="drawer-link" onclick="if(confirm('Logout?')) { auth.signOut(); window.location.reload(); }">Logout</div>
            
            <div class="theme-section">
                <p style="font-size:0.8rem; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Theme</p>
                <div class="theme-grid">
                    <div class="theme-opt" onclick="window.changeTheme('sakura')" style="border-left:4px solid #ff69b4;">Sakura</div>
                    <div class="theme-opt" onclick="window.changeTheme('dark')" style="border-left:4px solid #333;">Dark</div>
                    <div class="theme-opt" onclick="window.changeTheme('light')" style="border-left:4px solid #ddd;">Light</div>
                    <div class="theme-opt" onclick="window.changeTheme('blue')" style="border-left:4px solid #2196f3;">Blue</div>
                </div>
            </div>
        </div>

        <!-- AUTH VIEW -->
        <div id="auth-view" class="container hidden" style="margin-top: 80px;">
            <div class="auth-box">
                <h2 id="auth-title" style="margin-bottom: 8px;">Welcome</h2>
                <p style="color:var(--text-muted); margin-bottom:24px;">Login to access wallet</p>
                <input type="text" id="username" placeholder="Username" class="form-input hidden" style="margin-bottom:12px;">
                <input type="email" id="email" placeholder="Email" class="form-input" style="margin-bottom:12px;">
                <input type="password" id="password" placeholder="Password" class="form-input">
                <button class="auth-btn" id="auth-action-btn" onclick="window.handleAuth()">Sign In</button>
                <div class="toggle-auth" onclick="window.switchAuthMode()">Create an Account</div>
                <p id="auth-msg" style="margin-top:10px; font-size:0.8rem; color:red;"></p>
            </div>
        </div>

        <!-- PROFILE VIEW -->
        <div id="profile-view" class="container hidden" style="margin-top: 80px;">
            <div class="auth-box">
                <div class="profile-card">
                    <div class="profile-avatar" id="p-avatar">?</div>
                    <h2 class="profile-name" id="p-name">User</h2>
                    <p class="profile-email" id="p-email">user@email.com</p>
                    <div class="profile-stat">
                        <div style="font-size:0.8rem; color:var(--text-muted);">Wallet Balance</div>
                        <div style="font-size:1.5rem; font-weight:800; color:var(--accent);" id="p-wallet">0</div>
                    </div>
                    <button class="auth-btn" style="background:transparent; border:1px solid var(--border); color:var(--text-main);" onclick="window.logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- HOME VIEW -->
        <div id="home-view">
            <div class="hero-banner">
                <img id="hero-img" src="" alt="Banner" class="hero-img skeleton" loading="eager" fetchpriority="high">
                <div class="hero-overlay" style="display:none;"></div>
            </div>

            <div class="container">
                <div class="quick-actions">
                    <div class="action-card" onclick="window.openAddCoins()">
                        <div class="action-icon-box"><svg class="action-icon" viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg></div>
                        <span class="action-text">Add Coins</span>
                    </div>
                    <div class="action-card" onclick="window.loadHistory()">
                        <div class="action-icon-box"><svg class="action-icon" viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg></div>
                        <span class="action-text">History</span>
                    </div>
                    <div class="action-card" onclick="window.loadRankings()">
                        <div class="action-icon-box"><svg class="action-icon" viewBox="0 0 24 24"><path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/></svg></div>
                        <span class="action-text">Ranking</span>
                    </div>
                </div>

                <div class="search-wrap" style="margin:24px 0; position:relative;">
                    <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    <input type="text" class="search-input" placeholder="Search games..." onkeyup="window.filterGames(this.value)">
                </div>

                <div class="games-grid" id="games-grid">
                    <div class="skeleton" style="aspect-ratio:1/1;"></div>
                </div>
            </div>
        </div>

        <!-- PRODUCT VIEW -->
        <div id="product-view" class="hidden">
            <div class="product-header">
                <div class="back-btn" onclick="window.setView('home')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </div>
                <img id="prod-banner" src="" class="skeleton" loading="lazy">
            </div>
            <div class="container">
                <h2 id="prod-title" style="margin-bottom:6px;">Loading...</h2>
                <div class="input-group">
                    <div><label class="form-label">Player ID</label><input type="tel" id="user-id" placeholder="e.g. 12345678" class="form-input"></div>
                    <div><label class="form-label">Zone ID</label><input type="tel" id="zone-id" placeholder="e.g. 1234" class="form-input"></div>
                </div>
                <h3 style="margin-bottom:12px; font-size:1rem;">Select Pack</h3>
                <div class="packs-grid" id="packs-grid"></div>
                <div class="upi-container selected">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/UPI-Logo-vector.svg" style="height:28px; width:auto;">
                </div>
                <button class="pay-btn" onclick="window.processPayment()">PROCEED TO PAY</button>
            </div>
        </div>

        <!-- HISTORY & RANKING VIEWS -->
        <div id="history-view" class="container hidden" style="margin-top:80px;">
            <div class="flex" style="margin-bottom:20px;"><button onclick="window.setView('home')" style="margin-right:12px; font-size:1.5rem;">‚Üê</button><h2>Order History</h2></div>
            <div id="history-list"></div>
        </div>
        <div id="ranking-view" class="container hidden" style="margin-top:80px;">
            <div class="flex" style="margin-bottom:20px;"><button onclick="window.setView('home')" style="margin-right:12px; font-size:1.5rem;">‚Üê</button><h2>Top Spenders</h2></div>
            <div id="ranking-list"></div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="dev-contact" onclick="window.location.href='https://wa.me/918413813101'">Contact Dev</div>
            <div class="footer-socials">
                <a id="social-insta" href="#" target="_blank">
                    <svg class="footer-social-icon" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                </a>
                <a href="https://wa.me/916000859515" target="_blank">
                    <svg class="footer-social-icon" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></path></svg>
                </a>
            </div>
            <p style="font-size:0.8rem; color:var(--text-muted); margin-top:8px;">&copy; 2025 PLAY ZONE STORE.</p>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal" id="add-coins-modal">
        <div class="modal-box">
            <h3 style="margin-bottom:10px;">Add Coins</h3>
            <p style="color:var(--text-muted); margin-bottom:15px; font-size:0.9rem;">Min: 10 | Max: 10,000</p>
            <input type="number" id="coin-amount" placeholder="Amount (‚Çπ)" class="form-input" min="10" max="10000">
            <button onclick="window.proceedCoinPayment()" class="pay-btn" style="margin-top:10px;">Proceed</button>
            <button onclick="window.closeModal()" style="margin-top:10px; color:var(--text-muted); background:none; border:none;">Cancel</button>
        </div>
    </div>

    <div class="modal" id="msg-modal">
        <div class="modal-box">
            <h3 id="msg-title" style="margin-bottom:10px;">Message</h3>
            <div id="msg-body" style="color:var(--text-muted); margin-bottom:20px; max-height:400px; overflow-y:auto; text-align:left;">Details</div>
            <button onclick="window.closeModal()" class="auth-btn">Okay</button>
        </div>
    </div>

    <div class="modal" id="payment-modal">
        <div class="pay-modal-box">
            <div style="position:absolute; top:20px; right:20px; font-size:1.5rem; cursor:pointer;" onclick="window.closeModal()">‚úï</div>
            <div style="font-size:1.2rem; font-weight:800; margin-bottom:8px;">Complete Payment</div>
            <p style="color:#666; font-size:0.9rem; margin-bottom:30px;" id="pay-summary">Loading...</p>
            <div style="width:200px; height:200px; margin:0 auto 20px; border:2px solid #eee; padding:10px;"><img id="qr-code-img" style="width:100%; height:100%;"></div>
            <p style="font-size:0.9rem; color:#444; margin-bottom:30px;">1. Scan QR Code<br>2. Click below to verify on WhatsApp</p>
            <button onclick="window.verifyOnWhatsApp()" style="background:#25D366; color:white; border:none; padding:14px; border-radius:12px; width:100%; font-weight:700;">Verify on WhatsApp</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set, push, get, child, query, limitToLast, orderByChild } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA2qikzYchiOHELPvFVwmBpw8eqCD9AF5g",
            authDomain: "playzone-official-425a1.firebaseapp.com",
            databaseURL: "https://playzone-official-425a1-default-rtdb.firebaseio.com",
            projectId: "playzone-official-425a1",
            storageBucket: "playzone-official-425a1.firebasestorage.app",
            messagingSenderId: "835775864180",
            appId: "1:835775864180:web:3a32eeb42cd557f65fa021",
            measurementId: "G-78ZV21GJSQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;
        let activeGame = null;
        let selectedPack = null;
        let gamesCache = null;
        let isSignup = false;
        let currentOrderDetails = null;
        let isProcessing = false;

        const savedTheme = localStorage.getItem('theme') || 'sakura';
        document.documentElement.setAttribute('data-theme', savedTheme);

        window.changeTheme = (t) => {
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
            if(currentUser) set(ref(db, `users/${currentUser.uid}/theme`), t);
        };

        window.toggleAuth = () => { if(currentUser) window.setView('profile'); else window.setView('auth'); };
        window.handleProfileClick = () => window.toggleAuth();
        window.logout = () => { if(confirm("Logout?")) { auth.signOut(); window.location.reload(); } };
        
        window.switchAuthMode = () => {
            isSignup = !isSignup;
            document.getElementById('auth-title').innerText = isSignup ? "Create Account" : "Welcome Back";
            document.getElementById('auth-action-btn').innerText = isSignup ? "Sign Up" : "Sign In";
            document.getElementById('username').classList.toggle('hidden', !isSignup);
        };

        window.handleAuth = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            const u = document.getElementById('username').value;
            const msg = document.getElementById('auth-msg');

            if(isSignup) {
                if(!u) return msg.innerText = "Username is required";
                createUserWithEmailAndPassword(auth, e, p).then(cred => {
                    updateProfile(cred.user, { displayName: u }).then(() => {
                        set(ref(db, `users/${cred.user.uid}`), { username: u, email: e, wallet: 0 });
                        window.setView('home');
                    });
                }).catch(err => msg.innerText = err.message);
            } else {
                signInWithEmailAndPassword(auth, e, p).then(() => window.setView('home')).catch(err => msg.innerText = err.message);
            }
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if(user) {
                document.getElementById('p-email').innerText = user.email;
                document.getElementById('p-name').innerText = user.displayName || "User";
                document.getElementById('p-avatar').innerText = (user.displayName || "U").charAt(0).toUpperCase();

                onValue(ref(db, `users/${user.uid}/wallet`), snap => {
                    const bal = snap.val() || 0;
                    document.getElementById('user-coins').innerText = bal;
                    if(document.getElementById('p-wallet')) document.getElementById('p-wallet').innerText = bal;
                });
                onValue(ref(db, `notifications/${user.uid}`), snap => {
                    if(snap.val()) document.getElementById('notif-badge').classList.add('active');
                });
            }
        });

        // GAMES
        onValue(ref(db, 'games'), (snap) => {
            const data = snap.val();
            if(data) {
                gamesCache = Object.values(data).filter(g => g.active !== false);
                const grid = document.getElementById('games-grid');
                grid.innerHTML = gamesCache.map(g => `
                    <div class="game-card" onclick="window.openGame(${g.id})">
                        <div class="game-img-wrap"><img src="${g.img}" loading="lazy"></div>
                        <div class="game-title">${g.name}</div>
                    </div>`).join('');
            }
        });

        onValue(ref(db, 'heroBanner'), s => { if(s.val()) document.getElementById('hero-img').src = s.val(); });
        onValue(ref(db, 'settings/instagram'), s => { if(s.val()) document.getElementById('social-insta').href = s.val(); });

        window.openGame = async (gameId) => {
            const game = gamesCache.find(g => g.id == gameId);
            if(!game) return;
            activeGame = game;
            document.getElementById('prod-title').innerText = game.name;
            document.getElementById('prod-banner').src = game.banner || game.img;
            
            // USE PACK DISPLAY IMAGE IF AVAILABLE, ELSE FALLBACK TO GAME LOGO
            const displayImg = activeGame.packImage || activeGame.img;
            
            const snap = await get(child(ref(db), `packs/${gameId}`));
            const packs = snap.val() || [];
            
            document.getElementById('packs-grid').innerHTML = packs.map((p, idx) => {
                // FIX: Only show image if explicit pack image exists, else text only
                const imgUrl = p.imageUrl || activeGame.packImage; 
                const imgHtml = imgUrl ? `<img src="${imgUrl}" class="pack-img" loading="lazy">` : '';

                return `
                <div class="pack-card" id="pack-${idx}" onclick="window.selectPack(${idx}, '${p.name}', ${p.price})">
                    ${imgHtml}
                    <div class="pack-name">${p.name}</div>
                    <div class="pack-price">‚Çπ${p.price}</div>
                </div>`;
            }).join('');
            
            window.setView('product');
        };

        window.selectPack = (idx, name, price) => {
            selectedPack = { name, price };
            document.querySelectorAll('.pack-card').forEach(el => el.classList.remove('selected'));
            document.getElementById(`pack-${idx}`).classList.add('selected');
        };

        // WALLET PAYMENT LOGIC
        window.processPayment = () => {
            if(isProcessing) return;
            if(!currentUser) return window.showModal("Login Required", "Please sign in.");
            if(!selectedPack) return window.showModal("Select Pack", "Please select a pack.");
            const uid = document.getElementById('user-id').value.trim();
            const zid = document.getElementById('zone-id').value.trim();
            
            // VALIDATION
            const uidEl = document.getElementById('user-id');
            const zidEl = document.getElementById('zone-id');
            uidEl.classList.remove('error');
            zidEl.classList.remove('error');
            if(!uid) { uidEl.classList.add('error'); return window.showModal("Missing ID", "Player ID is required."); }
            if(!zid) { zidEl.classList.add('error'); return window.showModal("Missing Zone", "Zone ID is strictly required."); }

            isProcessing = true; 
            get(ref(db, `users/${currentUser.uid}/wallet`)).then(snap => {
                const balance = snap.val() || 0;
                const price = parseInt(selectedPack.price);

                if (balance >= price) {
                    if(confirm(`Pay ‚Çπ${price} using Wallet Balance? (Current: ‚Çπ${balance})`)) {
                         set(ref(db, `users/${currentUser.uid}/wallet`), balance - price);
                         
                         const orderRef = push(ref(db, `orders/${currentUser.uid}`));
                         const orderData = {
                            id: orderRef.key,
                            uid: currentUser.uid,
                            username: currentUser.displayName,
                            email: currentUser.email,
                            game: activeGame.name,
                            pack: selectedPack.name,
                            amount: price,
                            playerId: uid,
                            zoneId: zid,
                            status: "PENDING",
                            method: "WALLET",
                            createdAt: new Date().toISOString()
                         };
                         
                         set(orderRef, orderData).then(() => {
                             // FIX: WhatsApp Redirect for Wallet Payment
                             const msg = `Hey üëã PLAY ZONE STORE,\nI paid ‚Çπ${price} via Wallet for ${selectedPack.name}.\n\nOrder ID: ${orderData.id}\nName: ${orderData.username}\nEmail: ${orderData.email}`;
                             window.location.href = `https://wa.me/916000859515?text=${encodeURIComponent(msg)}`;
                             isProcessing = false;
                         });
                    } else { isProcessing = false; }
                } else {
                    currentOrderDetails = { 
                        type: 'PACK', game: activeGame.name, pack: selectedPack.name, 
                        amount: selectedPack.price, playerId: uid, zoneId: zid,
                        email: currentUser.email, username: currentUser.displayName
                    };
                    window.showPaymentGateway(selectedPack.price, selectedPack.name);
                    isProcessing = false;
                }
            });
        };

        window.openAddCoins = () => {
            if(!currentUser) return window.showModal("Login Required", "Please sign in.");
            document.getElementById('add-coins-modal').classList.add('active');
        };

        window.proceedCoinPayment = () => {
            const amount = parseInt(document.getElementById('coin-amount').value);
            if(!amount || amount < 10 || amount > 10000) return alert("Enter amount 10-10000");
            document.getElementById('add-coins-modal').classList.remove('active');
            currentOrderDetails = { type: 'COINS', amount: amount, desc: `${amount} Coins`, email: currentUser.email, username: currentUser.displayName };
            window.showPaymentGateway(amount, `${amount} Coins`);
        };

        window.showPaymentGateway = (amount, desc) => {
            document.getElementById('pay-summary').innerText = `${desc} - ‚Çπ${amount}`;
            const upi = `upi://pay?pa=6000859515@slc&pn=PlayZoneStore&am=${amount}&cu=INR`;
            document.getElementById('qr-code-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upi)}`;
            document.getElementById('payment-modal').classList.add('active');
        }

        window.verifyOnWhatsApp = () => {
            if(!currentOrderDetails) return;
            const refId = push(ref(db, `orders/${currentUser.uid}`));
            const data = { id: refId.key, uid: currentUser.uid, status: "PENDING", date: new Date().toISOString(), method: "UPI", ...currentOrderDetails };
            set(refId, data).then(() => {
                const msg = `Hey üëã PLAY ZONE STORE,\nI have paid ‚Çπ${data.amount} for ${data.desc||data.pack}.\nOrder ID: ${data.id}\nName: ${data.username}\nEmail: ${data.email}\nHere is screenshot.`;
                window.location.href = `https://wa.me/916000859515?text=${encodeURIComponent(msg)}`;
            });
        };

        window.openPolicy = async (key, title) => {
            const snap = await get(ref(db, `settings/${key}`));
            const text = snap.val() ? snap.val().replace(/\n/g, '<br>') : "Coming Soon.";
            window.showModal(title, text);
            document.getElementById('drawer').classList.remove('open');
            document.getElementById('overlay').classList.remove('open');
        };

        window.loadHistory = () => {
            if(!currentUser) return window.showModal("Login Required", "Sign in.");
            onValue(query(ref(db, `orders/${currentUser.uid}`), limitToLast(20)), snap => {
                const list = document.getElementById('history-list');
                if(!snap.val()) list.innerHTML = "<p style='text-align:center'>No orders found.</p>";
                else list.innerHTML = Object.values(snap.val()).reverse().map(o => `
                    <div class="list-item">
                        <div><div style="font-weight:700">${o.type==='COINS'?'Wallet Topup':o.game}</div><div style="font-size:0.8rem; color:#777">${o.desc||o.pack} ‚Ä¢ ${o.method||'UPI'}</div></div>
                        <div style="text-align:right"><div class="status-badge status-${o.status.toLowerCase()}">${o.status}</div><div style="font-weight:700">‚Çπ${o.amount}</div></div>
                    </div>`).join('');
                window.setView('history');
            });
        };

        window.loadRankings = async () => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = '<p style="text-align:center">Loading live data...</p>';
            window.setView('ranking');
            try {
                const snap = await get(ref(db, 'orders'));
                const allOrders = snap.val();
                if(!allOrders) throw new Error("No data");
                const totals = {};
                Object.keys(allOrders).forEach(uid => {
                    const orders = Object.values(allOrders[uid]);
                    totals[uid] = orders.reduce((sum, o) => sum + (parseInt(o.amount)||0), 0);
                });
                const sorted = Object.entries(totals).sort(([,a], [,b]) => b - a).slice(0, 10);
                list.innerHTML = sorted.map((item, i) => `<div class="list-item"><div class="flex"><span class="rank-num">${i + 1}</span><span>User_${item[0].slice(0,5)}</span></div><span style="font-weight:700">‚Çπ${item[1].toLocaleString()}</span></div>`).join('');
            } catch(e) { list.innerHTML = "<p style='text-align:center'>No rankings available yet.</p>"; }
        };

        window.filterGames = (v) => {
            if(!gamesCache) return;
            document.getElementById('games-grid').innerHTML = gamesCache.filter(g => g.name.toLowerCase().includes(v.toLowerCase())).map(g => `<div class="game-card" onclick="window.openGame(${g.id})"><div class="game-img-wrap"><img src="${g.img}"></div><div class="game-title">${g.name}</div></div>`).join('');
        };

        window.toggleDrawer = () => {
            const d = document.getElementById('drawer'), o = document.getElementById('overlay');
            if(d.classList.contains('open')) { d.classList.remove('open'); o.classList.remove('open'); }
            else { d.classList.add('open'); o.classList.add('open'); }
        };

        window.setView = (id) => {
            document.querySelectorAll('[id$="-view"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${id}-view`).classList.remove('hidden');
            document.getElementById('drawer').classList.remove('open');
            document.getElementById('overlay').classList.remove('open');
            window.scrollTo(0,0);
        };

        window.openNotifications = () => {
            if(!currentUser) return window.showModal("Access Denied", "Please login.");
            document.getElementById('notif-badge').classList.remove('active');
            get(ref(db, `notifications/${currentUser.uid}`)).then(snap => {
                const data = snap.val();
                if(!data) return window.showModal("Notifications", "No new messages.");
                let html = `<div class="notif-list">`;
                Object.values(data).reverse().forEach(n => {
                    html += `<div class="notif-item"><div class="notif-title">${n.title}</div><div class="notif-body">${n.body}</div></div>`;
                });
                html += `</div>`;
                window.showModal("Notifications", html);
            });
        };

        window.showModal = (t, b) => {
            document.getElementById('msg-title').innerText = t;
            document.getElementById('msg-body').innerHTML = b;
            document.getElementById('msg-modal').classList.add('active');
        };
        window.closeModal = () => document.querySelectorAll('.modal').forEach(el => el.classList.remove('active'));

    </script>
</body>
</html>